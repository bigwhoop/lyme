/*! LYME v1.2.5 (2013-05-29) | http://bigwhoop.github.io/lyme | MIT License */
$.fn.lyme=function(e){var n={markup:"",onMarkupChange:null,onPreInit:null,onPostInit:null,renderer:new $.fn.lyme.renderers.JSMarkdownExtra,plugins:[new $.fn.lyme.plugins.ScrollTo],hotKeys:$.fn.lyme.hotKeys},t=$.extend(n,e);if(t.markup instanceof $){var r=t.markup;t.plugins.push(new $.fn.lyme.plugins.TextareaAdapter(r))}t.plugins.forEach(function(e){$.isFunction(e.onGetMarkup)&&(t.markup=e.onGetMarkup())});var i={};if($.each(["onMarkupChange","onPreInit","onPostInit"],function(){$.isFunction(t[this])&&(i[this]=t[this])}),t.plugins.push(i),1==this.length)return new $.fn.lyme.Editor($(this),t);var o={};return this.each(function(){o[this.selector]=new $.fn.lyme.Editor($(this),t)}),o},$.fn.lyme.Editor=function(e,n){function t(){e.on("click",function(e){e.stopPropagation()}),$(document).on("click",function(){o.hideEditor()}),n.plugins.forEach(function(e){$.isFunction(e.setEditor)&&e.setEditor(o)}),r("onPreInit",[e,n]),o.setMarkup(n.markup),r("onPostInit",[o.getFullMarkup(),o.getFullHTML()])}function r(e,t){$.isArray(t)||(t=[]),n.plugins.forEach(function(n){$.isFunction(n[e])&&n[e].apply(null,t)})}function i(){return u++}var o=this;o.setRenderer=function(e){n.renderer=e},o.splitMarkup=function(e){return $.isFunction(n.renderer.split)?n.renderer.split(e):e.replace(/\r/g,"").replace(/\n\n\n/g,"\n\n").split("\n\n")},o.joinMarkup=function(e){return $.isFunction(n.renderer.join)?n.renderer.join(e):e.join("\n\n")};var u=0;o.createBlock=function(e,t){function u(e){var t=c.val(),i=s;return $.each(o.splitMarkup(t),function(e,t){var r=n.renderer.render(t);if(0==e)c.val(t),f.html(r);else{var u=o.createBlock(t,r);i.after(u.getElement()),i=u.getElement()}}),e!=t&&r("onMarkupChange",[o.getFullMarkup(),o.getFullHTML()]),t}t||(t=n.renderer.render(e));var a=i(),s=$('<div id="lyme-block-'+a+'" class="lyme-block">'),l=$('<div class="markup"></div>'),c=$("<textarea></textarea>"),f=$('<div class="preview"></div>');c.val(e),f.html(t),l.hide().append(c),s.append(l).append(f);var p=new $.fn.lyme.Block(s);return c.on("focusout",function(){r("onPreStopEditing",[p]),""==c.val()&&s.remove(),e=u(e),r("onPostStopEditing",[p])}),c.on("keydown",function(e){for(var t in n.hotKeys){var r=n.hotKeys[t];r.if(e)&&(e.preventDefault(),r.do(o,p))}}),f.on("click",function(){o.hideEditor(),r("onPreStartEditing",[p]),f.hide(),l.show(),c.focus(),r("onPostStartEditing",[p])}),p},o.getFullMarkup=function(){var n=[];return e.find(".lyme-block .markup textarea").each(function(){n.push($(this).val())}),o.joinMarkup(n)},o.getFullHTML=function(){return n.renderer.render(o.getFullMarkup())},o.setMarkup=function(n){e.empty(),$.each(o.splitMarkup(n),function(n,t){var r=o.createBlock(t);e.append(r.getElement())})},o.getElement=function(){return e},o.hideEditor=function(){e.find(".lyme-block .markup:visible textarea").blur(),e.find(".lyme-block .markup:visible").hide(),e.find(".lyme-block .preview").show()},t()},$.fn.lyme.Block=function(e){this.edit=function(){e.find(".preview").trigger("click")},this.getPreviousBlock=function(){var n=e.prev();return n.length?new $.fn.lyme.Block(n):!1},this.getNextBlock=function(){var n=e.next();return n.length?new $.fn.lyme.Block(n):!1},this.getMarkup=function(){return e.find("textarea").val()},this.setMarkup=function(n){e.find("textarea").val(n)},this.getElement=function(){return e}},$.fn.lyme.renderers={JSMarkdownExtra:function(){var e;this.render=function(n){return e||(e=new MarkdownExtra_Parser,e.init()),e.transform(n)},this.split=function(e){e=e.replace(/\r/g,"");var n=RegExp("(?:~{3,}[ ]*\n[^]*?\n~{3,})+","g"),t=[];e.replace(n,function(n){var r="_LYME_PLACEHOLDER_"+t.length+"_";e=e.replace(n,r),t.push(n)});var r=e.replace(/\n\n\n/g,"\n\n").split("\n\n");for(var i in t)$.each(r,function(e,n){n=="_LYME_PLACEHOLDER_"+i+"_"&&(r[e]=t[i])});return r}},Showdown:function(){var e;this.render=function(n){return e||(e=new Showdown.converter),e.makeHtml(n)}}},$.fn.lyme.hotKeys={tabbing:{indentation:"    ","if":function(e){return 9==e.keyCode},"do":function(e,n){var t=n.getElement().find("textarea").get(0),r=t.selectionStart;t.value=t.value.substring(0,t.selectionStart)+this.indentation+t.value.substring(t.selectionEnd,t.value.length),setTimeout(function(){t.focus(),t.setSelectionRange(r+4,r+4)},0)}},escape:{"if":function(e){return 27==e.keyCode},"do":function(e){e.hideEditor()}},"place-before":{"if":function(e){return e.altKey&&e.ctrlKey&&e.shiftKey&&38==e.keyCode},"do":function(e,n){var t=n.getPreviousBlock();if(t){var r=n.getMarkup(),i=t.getMarkup();n.setMarkup(i),t.setMarkup(r),t.edit()}}},"place-after":{"if":function(e){return e.altKey&&e.ctrlKey&&e.shiftKey&&40==e.keyCode},"do":function(e,n){var t=n.getNextBlock();if(t){var r=n.getMarkup(),i=t.getMarkup();n.setMarkup(i),t.setMarkup(r),t.edit()}}},"move-up":{"if":function(e){return e.altKey&&e.ctrlKey&&38==e.keyCode},"do":function(e,n){var t=n.getPreviousBlock();t&&t.edit()}},"move-down":{"if":function(e){return e.altKey&&e.ctrlKey&&40==e.keyCode},"do":function(e,n){var t=n.getNextBlock();t&&t.edit()}},"append-empty-block":{"if":function(e){return e.altKey&&e.ctrlKey&&13==e.keyCode},"do":function(e,n){var t=e.createBlock("","");n.getElement().after(t.getElement()),t.edit()}},"remove-block":{"if":function(e){return e.altKey&&e.ctrlKey&&8==e.keyCode},"do":function(e,n){n.setMarkup("");var t=n.getPreviousBlock(),r=n.getNextBlock();t?t.edit():r?r.edit():e.hideEditor()}}},$.fn.lyme.plugins={ContentGuard:function(e,n){var t=!1,e="boolean"==typeof e?e:!0,n="boolean"==typeof n?n:!0;this.enable=function(){n=!0},this.disable=function(){n=!1},e&&$(document).on("submit","form",function(){n=!1}),this.onMarkupChange=function(){t=!0},$(window).bind("beforeunload",function(){return n&&t?"Are you sure you want to leave this page?":void 0})},TextareaAdapter:function(e,n){var t=$(e);this.onGetMarkup=function(){return t.val()},this.onMarkupChange=function(e,r){t.val(n?r:e)}},AjaxAdapter:function(e,n){e&&e.length&&(this.onGetMarkup=function(){var n="Failed to retrieve the from "+e;return $.ajax({url:e,type:"get",success:function(e){n=e},async:!1}),n}),n&&n.length&&(this.onMarkupChange=function(e,t){$.ajax({url:n,data:{markup:e,html:t},type:"post"})})},ScrollTo:function(e,n){$.isNumeric(e)||(e=300),$.isNumeric(n)||(n=50);var t;this.onPreStartEditing=function(r){window.clearTimeout(t),t=window.setTimeout(function(){$("html, body").animate({scrollTop:r.getElement().offset().top-n},750)},e)}}},$.fn.lyme.plugins.UndoRedo=function(e){var n;switch(e){case"localStorage":n=new $.fn.lyme.plugins.UndoRedo.LocalStorage;break;case"memory":default:n=new $.fn.lyme.plugins.UndoRedo.MemoryStorage}var t;this.setEditor=function(e){t=e},this.undo=function(){t.setMarkup(n.undo())},this.redo=function(){t.setMarkup(n.redo())},this.onPostInit=function(e){t.setMarkup(n.init(e))},this.onMarkupChange=function(e){n.push(e)}},$.fn.lyme.plugins.UndoRedo.LocalStorage=function(){function e(){localStorage.setItem(n,JSON.stringify(t))}const n="lyme";var t=new $.fn.lyme.plugins.UndoRedo.MemoryStorage,r=localStorage.getItem(n);r&&(persistedStorageObj=JSON.parse(r))&&(t.pointer=persistedStorageObj.pointer,t.entries=persistedStorageObj.entries),this.init=function(n){var r=t.getMarkup();if(r)return r;var i=t.init(n);return e(),i},this.push=function(n){t.push(n),e()},this.undo=function(){var n=t.undo();return e(),n},this.redo=function(){var n=t.redo();return e(),n}},$.fn.lyme.plugins.UndoRedo.MemoryStorage=function(){this.pointer=0,this.entries=[],this.init=function(e){return this.push(e),e},this.push=function(e){this.entries=this.entries.slice(0,this.pointer),this.entries[this.pointer++]=e},this.undo=function(){return this.pointer--,1>this.pointer&&(this.pointer=1),this.getMarkup()},this.redo=function(){return this.pointer++,this.pointer>this.entries.length&&(this.pointer=this.entries.length),this.getMarkup()},this.getMarkup=function(){return this.entries[this.pointer-1]}};